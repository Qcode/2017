{% extends 'base.html' %}

{% block main %}
    <p>Yo this is the index hahahah</p>
    <a href='#' onclick='signIn()'>Sign In</a>

    <script>
    var provider = new firebase.auth.GoogleAuthProvider();
    function signIn() {
        firebase.auth().signInWithPopup(provider).then(function(result) {
          // This gives you a Google Access Token. You can use it to access the Google API.
          var token = result.credential.accessToken;
          // The signed-in user info.
          var user = result.user;
          // ...
        });
    }
    firebase.auth().onAuthStateChanged(function(user) {
      if (user) {
        $.ajax({
            type: 'POST',
            url: '/api/signIn',
            data: {
                id: user.uid,
                email: user.email
            }
        }).done(
            function() {
                window.location = '/home';
            }
        ).fail(
            function() {
                alert('error');
            }
        );
      }
    });
    </script>
{% endblock %}
